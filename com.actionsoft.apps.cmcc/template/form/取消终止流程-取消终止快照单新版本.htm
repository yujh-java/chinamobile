<!DOCTYPE html>
<html>

<head>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

<!--[if IE]>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<![endif]-->

<!--[if IE]>
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <![endif]-->
<title>研究院项目取消终止审批流程</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="renderer" content="webkit">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<!--公共的js和css start-->
[#AWSImport] [#AWSUIImport]
<!--公共的js和css end-->
<!--配色方案-->
<link rel='stylesheet' id='schemeCss'
	href='../apps/_bpm.platform/css/colorschemes/scheme_aws.css?v=1427093101000'
	name='schemeCss' />
<link type='text/css' rel='stylesheet' id='buttonCss'
	href='../css/cmcc.common.css?v=1489747055000' name='buttonCss' />
<style>
body {
	min-width: 1248px !important;
	overflow: auto !important;
}
</style>
<link type='text/css' rel='stylesheet' id='themeCss'
	href='../apps/_bpm.platform/css/theme/theme.css?v=1508724470000?v=1508724470000?v=1508724470000?v=1508724470000?v=1508724470000?v=1508724470000?v=1500861824000?v=1496919285000'
	name='themeCss' />
<link type='text/css' rel='stylesheet' id='themeCss'
	href='../apps/_bpm.platform/css/theme/theme.css?v=1508724470000?v=1508724470000?v=1508724470000?v=1508724470000?v=1508724470000?v=1508724470000?v=1500861824000' name='themeCss' />






<link type='text/css' rel='stylesheet' id='themeCss' href='../apps/_bpm.platform/css/theme/theme.css' name='themeCss'/>
</head>

<body>
<form id="frmMain" method="post" name="frmMain">
<div border="0" style="display: none;"><a id="trackVar" border="0" href="#" target="_blank" rel="noopener"></a></div>
<table id="aws-form-maintable" class="awsui-ux aws-form-ux-maintable" style="table-layout: auto;" border="0" cellspacing="0" cellpadding="0" align="center"><!--每个模板必须含有 aws-form-titlebg 和 title样式 否则无法应用配色风格-->
<tbody>
<tr id="aws-form-titlebg" class="aws-form-ux-titlebg"><!--若自定义模板title的 id --></tr>
<tr id="aws-form-formcontent" class="aws-form-ux-formcontent">
<td>
<table style="border-collapse: separate; border-spacing: 0px;" width="100%" align="center">
<tbody>
<tr>
<td>
<table id="table_container" class="awsui-ux table-striped" style="padding: 0px;" width="100%" cellspacing="0" cellpadding="0">
<tbody>
<tr id="aws-form-formcontent">
<td><iframe id="urlFormIframe" style="width: 100%; height: 400px;" name="urlFormIframe" frameborder="0" scrolling="no"></iframe></td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="aws-form-bottom">
<td class="aws-form-ux-actionsoft">[#Actionsoft]</td>
</tr>
<tr class="aws-form-bottom" style="font-size: 14px;">
<td style="overflow: hidden;">
<div class="aws-form-ux-tab-content" border="0">
<div class="aws-form-ux-tab-item" border="0" style="border-top: 1px solid #DDD;" tit="tab1"><!--<h3 style="text-align:center;margin:0px 20px 20px 20px">审批意见</h3> -->
<table id="oplogs" class="table table-bordered table-striped" style="width: 100%;" align="center">
<tbody id="logsbody">
<tr>
<td colspan="2">
<div border="0" align="center"><strong>审批意见</strong></div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</td>
</tr>
</tbody>
</table>
</form>
<script language="JavaScript" src="../js/cmcc.common.toolbar.yjy.js?v=1491963007000" type="text/javascript"></script>
<script language="JavaScript" src="../js/commonAddProcessExplain.js?v=1500610717800" type="text/javascript"></script>
<script type="text/javascript" id="formOnload">// <![CDATA[
function formOnload() {
	PROCESSTYPE = "stop";
	var host = window.location.host;
	if (stepId == "obj_c796f44eaa700001a3dd1d701b201c54"
			&& openState == 1) {
		var newurl = "http://"
				+ host
				+ "/spms/cmri/workflow/stop?form=stop_read&type=cmri-stop&finance=edit&process_id=@processId()";
		document.getElementById("urlFormIframe").src = newurl;
	} else {
		var newurl = " http://"
				+ host
				+ "/spms/cmri/workflow/stop?form=stop_read&type=cmri-stop&finance=read&process_id=@processId()";
		document.getElementById("urlFormIframe").src = newurl;
	}
	awsui.ajax.request({
		type : "POST",
		url : "./jd",
		alert : false,
		dataType : "json",
		data : {
			cmd : "com.actionsoft.apps.cmcc_Cancel",
			sid : sid,
			processid : processInstId
		},
		success : function(data) {
			var html = data.msg;
			$("#logsbody").append(html);
		}
	});

	if (openState == 11) {
		reload_BTN_ADHOC_TASK_OK();
	}
}
$('#dialog_toolbar_action_page_frame').load(function() { 
	if(stepId == "obj_c796f4a05230000172731d3c4256c830"){//项目管理部门领导审核
		$("#BTN_Default_Action").removeAttr("onclick");
		var parentTaskState = "";
		if (openState == 1) {
			nextStepName_jq = "相关部所会签";
			//隐藏返回相关部所会签
			hiddenMemo("obj_4cdb6eb798ad4d538457df3f5e515b44");//返回相关部所会签
			$(window.frames["dialog_toolbar_action_page_frame"].document).find("#obj_4cdb6eb798ad4d538457df3f5e515b44").parent().next().next().remove();
			
			hiddenMemo("obj_975e04d2aaf245ae8e0c1877e7faafa9");//返回项目管理部门
			$(window.frames["dialog_toolbar_action_page_frame"].document).find("#obj_975e04d2aaf245ae8e0c1877e7faafa9").parent().next().next().remove();
			$("#dialog_toolbar_action_page_frame").show();
		}else{
			//隐藏不是加签的路径
			hiddenMemo("obj_6a40f7f445074d6295f198f0fe1ae938");
			hiddenMemo("obj_113326e0718f47998cd6562d1a83bcec");
			hiddenMemo("obj_5982682960e04ba39f0a7c52cf05698c");//传阅
			hiddenMemo("obj_494e8815961648f9abc9f9d645ba8d51");
			
			$(window.frames["dialog_toolbar_action_page_frame"].document).find("#obj_6a40f7f445074d6295f198f0fe1ae938").parent().next().next().remove();
			$(window.frames["dialog_toolbar_action_page_frame"].document).find("#obj_113326e0718f47998cd6562d1a83bcec").parent().next().next().remove();
			$(window.frames["dialog_toolbar_action_page_frame"].document).find("#obj_5982682960e04ba39f0a7c52cf05698c").parent().next().next().remove();
			$(window.frames["dialog_toolbar_action_page_frame"].document).find("#obj_494e8815961648f9abc9f9d645ba8d51").parent().next().next().remove();
			
			awsui.ajax.request({
				type : "POST",
				url : "./jd",
				alert:false,
				dataType : "json",
				data : {
					cmd : "com.actionsoft.apps.cmcc_getParentTaskState",
					sid:sid,
					parentTaskId:parentTaskInstId
				},
				ok : function(r) {
					var  taskState = r.data.taskState;
					parentTaskState = taskState;
					if(taskState==11){
						WBCDLJ = "相关部所会签";
						hiddenMemo("obj_975e04d2aaf245ae8e0c1877e7faafa9");//返回项目管理部门
						$(window.frames["dialog_toolbar_action_page_frame"].document).find("#obj_975e04d2aaf245ae8e0c1877e7faafa9").parent().next().next().remove();
			
						hiddenMemo("obj_a13b727e0f34440091a183fef10803d6");//隐藏送部所内部会签
						$(window.frames["dialog_toolbar_action_page_frame"].document).find("#obj_a13b727e0f34440091a183fef10803d6").parent().next().next().remove();
					}else{
						WBCDLJ = "项目管理部门领导审核";
						updateMemo("obj_a13b727e0f34440091a183fef10803d6","送相关部所内部会签");
						
						hiddenMemo("obj_4cdb6eb798ad4d538457df3f5e515b44");//返回相关部所会签
						$(window.frames["dialog_toolbar_action_page_frame"].document).find("#obj_4cdb6eb798ad4d538457df3f5e515b44").parent().next().next().remove();
                        
					}
					nextStepName_jq = "相关部所内部会签";
					$("#dialog_toolbar_action_page_frame").show();
				}
			});			
						
		}
		//处理加签
		setTimeout(function(){
			var actionIdMap = new Object();
			actionIdMap[3]="obj_a13b727e0f34440091a183fef10803d6";//送部所内部会签
			
			var toolbarsrc = document.getElementById("dialog_toolbar_action_page_frame").src;
			if(toolbarsrc.indexOf("cmd=CLIENT_BPM_TASK_TRANSACT")>-1){
				 if (openState == 1) {
					reload_BTN_Default_Action(actionIdMap,'obj_975e04d2aaf245ae8e0c1877e7faafa9','obj_a13b727e0f34440091a183fef10803d6','','obj_5982682960e04ba39f0a7c52cf05698c');//返回部所内部会签、传阅
				 }else if(openState == 11){
					if(parentTaskState != 11){
						reload_BTN_Default_Action(actionIdMap,'obj_975e04d2aaf245ae8e0c1877e7faafa9','','','obj_5982682960e04ba39f0a7c52cf05698c');
					}else{
						reload_BTN_Default_Action(actionIdMap,'obj_4cdb6eb798ad4d538457df3f5e515b44','','','obj_5982682960e04ba39f0a7c52cf05698c');
					}
				 }
			}else if(toolbarsrc.indexOf("cmd=CLIENT_BPM_TASK_CC_TASK_PAGE")>-1){
				var yzrMemoIdNotEnd = new Array();
				yzrMemoIdNotEnd.push(['obj_5982682960e04ba39f0a7c52cf05698c']);
				reload_BTN_Default_Action(null,null,null,null,null,yzrMemoIdNotEnd);
			}
		},500);

	}else if(stepId == "obj_c796f487e3f00001aca8e350d12f174b"){//项目管理人员
		$("#BTN_Default_Action").removeAttr("onclick");
		$("#dialog_toolbar_action_page_frame").show();
		//处理加签
		setTimeout(function(){
			var toolbarsrc = document.getElementById("dialog_toolbar_action_page_frame").src;
			if(toolbarsrc.indexOf("cmd=CLIENT_BPM_TASK_TRANSACT")>-1){
				if (openState == 1) {
					reload_BTN_Default_Action(null,null,null,"obj_76048321706e43019ef9d6a0df602e9e","obj_1d7cefa2fbc044c99507de3fc512095e");
				}
			}else if(toolbarsrc.indexOf("cmd=CLIENT_BPM_TASK_CC_TASK_PAGE")>-1){
				var yzrMemoIdNotEnd = new Array();
				yzrMemoIdNotEnd.push(['obj_1d7cefa2fbc044c99507de3fc512095e']);
				reload_BTN_Default_Action(null,null,null,null,null,yzrMemoIdNotEnd);
			}
		},500);
	}else{
		$("#dialog_toolbar_action_page_frame").show();
	}
});  
$(document).ready(function(){
	$("#BTN_TRANSACT").off("click").on("click", function() {
		$("#dialog_toolbar_action_page_frame").hide();
		FormToolBarAction.BTN_TRANSACT();		
	});
});
// ]]></script>
</body>
</html>