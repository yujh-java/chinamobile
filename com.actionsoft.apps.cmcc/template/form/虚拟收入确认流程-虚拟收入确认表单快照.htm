<!DOCTYPE html>
<html>
	<head>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

<!--[if IE]>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<![endif]-->

		<title>虚拟收入确认表单</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<meta name="renderer" content="webkit">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!--公共的js和css start-->
		[#AWSImport]
		[#AWSUIImport]
		<!--公共的js和css end-->
		<!--配色方案-->
		<link rel='stylesheet' id='schemeCss' href='../apps/_bpm.platform/css/colorschemes/scheme_aws.css'  name='schemeCss'/>
      
         <link type='text/css' rel='stylesheet' id='buttonCss' href='../css/cmcc.common.css?v=1489747055000' name='buttonCss'/>



<style>
body {
min-width: 1248px !important;overflow: auto !important;
}
</style>
<link type='text/css' rel='stylesheet' id='themeCss' href='../apps/_bpm.platform/css/theme/theme.css' name='themeCss'/>
</head>
	<body>
<form id="frmMain" method="post" name="frmMain">
<div border="0" style="display: none;"><a id="trackVar" border="0" href="#" target="_blank" rel="noopener"></a></div>
<table id="aws-form-maintable" class="awsui-ux aws-form-ux-maintable" style="table-layout: auto;" border="0" cellspacing="0" cellpadding="0" align="center"><!--每个模板必须含有 aws-form-titlebg 和 title样式 否则无法应用配色风格-->
<tbody>
<tr id="aws-form-titlebg" class="aws-form-ux-titlebg"><!--若自定义模板title的 id --></tr>
<tr id="aws-form-formcontent" class="aws-form-ux-formcontent">
<td>
<table style="border-collapse: separate; border-spacing: 0px;" width="100%" align="center">
<tbody>
<tr>
<td>
<table id="table_container" class="awsui-ux table-striped" style="padding: 0px;" width="100%" cellspacing="0" cellpadding="0">
<tbody>
<tr id="aws-form-formcontent">
<td><iframe id="urlFormIframe" style="width: 100%; height: 400px;" name="urlFormIframe" frameborder="0" scrolling="no"></iframe></td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="aws-form-bottom">
<td class="aws-form-ux-actionsoft">[#Actionsoft]</td>
</tr>
<tr class="aws-form-bottom" style="font-size: 14px;">
<td style="overflow: hidden;">
<div class="aws-form-ux-tab-content" border="0">
<div class="aws-form-ux-tab-item" border="0" style="border-top: 1px solid #DDD;" tit="tab1"><!--<h3 style="text-align:center;margin:0px 20px 20px 20px">审批意见</h3> -->
<table id="oplogs" class="table table-bordered table-striped" style="width: 100%;" align="center">
<tbody id="logsbody">
<tr>
<td colspan="2">
<div border="0" align="center"><strong>审批意见</strong></div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</td>
</tr>
</tbody>
</table>
</form>
<script language="JavaScript" src="../js/cmcc.common.toolbar.js?v=1491963007000" type="text/javascript"></script>
<script type="text/javascript">// <![CDATA[
$('#dialog_toolbar_action_page_frame').load(function() {
    if (stepId == "obj_c7ac81c4cab00001354c3546b7f12340") { //需求部门会签节点
		 $("#dialog_toolbar_action_page_frame").show();
    
		 var subtask = "";//当前任务实例是否有子任务
        	awsui.ajax.request({
                type: "POST",
                url: "./jd",
                alert: false,
                dataType: "json",
                data: {
                  cmd: "com.actionsoft.apps.cmcc_querySubTask",
                  sid: sid,
                  taskInstId: taskId
                },
                ok: function(r) {
                	subtask = r.data.msg;
                	if (openState == 1) {
                		 WBCDLJ = "需求部门内部会签";
                		 nextStepName_jq = "需求部门内部会签";
                        hiddenMemo("obj_58b86fca6e4342ec9f9f9395505cb91b");
                        $(window.frames["dialog_toolbar_action_page_frame"].document).find("#obj_58b86fca6e4342ec9f9f9395505cb91b").parent().next().next().remove();
                        if(subtask=="有"){
                        	hiddenMemo("obj_46579c8be9d34ca3a8e9e8630715e4c8");
                        	  updateMemo("obj_a6a6d63b507c45eba256c33fd4389036","送总部研发项目接口人处理");
	                        $(window.frames["dialog_toolbar_action_page_frame"].document).find("#obj_46579c8be9d34ca3a8e9e8630715e4c8").parent().next().next().remove();
                        }else if(subtask=="没有"){
                        	hiddenMemo("obj_a6a6d63b507c45eba256c33fd4389036");
	                        $(window.frames["dialog_toolbar_action_page_frame"].document).find("#obj_a6a6d63b507c45eba256c33fd4389036").parent().next().next().remove();
                        }
                      } else if (openState == 11) {
                       
                      //  hiddenMemo("obj_ccc2a8d58ba34121813674f3e152ad20");
                        hiddenMemo("obj_46579c8be9d34ca3a8e9e8630715e4c8");
                        hiddenMemo("obj_768c2ced2e5949f680ee7aa8207e8666");
                        hiddenMemo("obj_a6a6d63b507c45eba256c33fd4389036");
                        //$(window.frames["dialog_toolbar_action_page_frame"].document).find("#obj_ccc2a8d58ba34121813674f3e152ad20").parent().next().next().remove();
                        $(window.frames["dialog_toolbar_action_page_frame"].document).find("#obj_46579c8be9d34ca3a8e9e8630715e4c8").parent().next().next().remove();
                        $(window.frames["dialog_toolbar_action_page_frame"].document).find("#obj_768c2ced2e5949f680ee7aa8207e8666").parent().next().next().remove();
                        $(window.frames["dialog_toolbar_action_page_frame"].document).find("#obj_a6a6d63b507c45eba256c33fd4389036").parent().next().next().remove();
                        awsui.ajax.request({
                            type: "POST",
                            url: "./jd",
                            alert: false,
                            dataType: "json",
                            data: {
                              cmd: "com.actionsoft.apps.cmcc_getParentTaskState",
                              sid: sid,
                              parentTaskId: parentTaskInstId
                            },
                            ok: function(r) {
                              var taskState = r.data.taskState;
                              if (taskState == 11) {
                            	  WBCDLJ = "需求部门内部会签";
      	                        nextStepName_jq = "需求部门内部会签";
                            	  hiddenMemo("obj_ccc2a8d58ba34121813674f3e152ad20");
                            	  updateMemo("obj_58b86fca6e4342ec9f9f9395505cb91b","返回需求部门内部会签");
                            	  $(window.frames["dialog_toolbar_action_page_frame"].document).find("#obj_ccc2a8d58ba34121813674f3e152ad20").parent().next().next().remove();
    						  }else{
    							  WBCDLJ = "需求部门会签";
    		                       nextStepName_jq = "需求部门其他人会签";
    							  updateMemo("obj_ccc2a8d58ba34121813674f3e152ad20","送需求部门其他人会签"); 
    						  }
    						  }
    						  });
                      }
                }
        	});
      setTimeout(function() {
        var actionIdMap = new Object();
        actionIdMap[3] = "obj_ccc2a8d58ba34121813674f3e152ad20"; //加签
        var toolbarsrc = document.getElementById("dialog_toolbar_action_page_frame").src;
        if (toolbarsrc.indexOf("cmd=CLIENT_BPM_TASK_TRANSACT") > -1) {
          if (openState == 1) {
            reload_BTN_Default_Action(actionIdMap, "obj_58b86fca6e4342ec9f9f9395505cb91b", null);
          } else if (openState == 11) {
            reload_BTN_Default_Action(actionIdMap, "obj_58b86fca6e4342ec9f9f9395505cb91b", null);
          }
        }

      }, 200);

    }else if(stepId=="obj_c7ac81db6bc00001ea231380b05e1e4d"){
    	$("#BTN_Default_Action").removeAttr("onclick");
		 $("#dialog_toolbar_action_page_frame").show();
		var yzrMemoIdEnd = new Array();
           yzrMemoIdEnd.push(['obj_e534a604da78431ba5c4b9d1ac8f3d18']);
            reload_BTN_Default_Action(null, null, null, null, null, yzrMemoIdEnd);
	}else{
        $("#dialog_toolbar_action_page_frame").show();
	}

  });

  $(document).ready(function() {
    $("#BTN_TRANSACT").off("click").on("click",
    function() {
      $("#dialog_toolbar_action_page_frame").hide();
      FormToolBarAction.BTN_TRANSACT();
    });
  });
// ]]></script>
<script id="formOnload">// <![CDATA[
function formOnload(){
  var host = window.location.host;
   var newurl=" http://"+host+"/spms/hq/workflow/virtualbudget?&form=virtual_budget_read&process_id=@processId()";
     document.getElementById("urlFormIframe").src = newurl;
 awsui.ajax.request({
		type : "POST",
		url : "./jd",
        alert:false,
		dataType : "json",
		data : {
			cmd : "com.actionsoft.apps.cmcc_Virtual",
			sid:sid,
			processid:processInstId
		},
		success : function(data) {
			var html = data.msg;
			$("#logsbody").append(html);
		}
	});
	 if (openState == 11) {
          reload_BTN_ADHOC_TASK_OK();
        }
}
// ]]></script>
</body>
</html>